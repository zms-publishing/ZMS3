<!DOCTYPE html>
<html lang="en">
<tal:block tal:content="structure python:here.zmi_html_head(here,request)">zmi_html_head</tal:block>
<body tal:attributes="class python:here.zmi_body_class(id='search')">
<tal:block tal:content="structure python:here.zmi_body_header(here,request)">zmi_body_header</tal:block>
<div id="zmi-tab">
<tal:block tal:content="structure python:here.zmi_breadcrumbs(here,request)">zmi_breadcrumbs</tal:block>

<form name="searchform" class="form-horizontal" method="get">
	<input type="hidden" name="lang" tal:attributes="value python:request['lang']" />
	<input type="hidden" name="preview" tal:attributes="value python:request['preview']" />
	<legend tal:content="python:here.getZMILangStr('SEARCH_HEADER')">Search header</legend>
	<div class="form-group">
		<div class="col-md-12">
			<div class="input-group">
				<tal:block tal:content="structure python:here.getTextInput(fmName='searchform',elName='search',value=request.get('search',''))">the value</tal:block>
				<span class="input-group-btn">
			<button type="submit" class="btn btn-primary">
				<tal:block tal:content="structure python:here.zmi_icon(name='icon-search')"></tal:block>
			</button>
				</span>
			</div>
		</div>
	</div><!-- .form-group -->
<tal:comment replace="nothing">
	<div class="form-group" tal:define="global optpl python:map(lambda x: [x,here.display_type(request,x)], here.getMetaobjIds(excl_ids=['ZMS']))">
		<div class="col-sm-9 col-md-10" tal:content="structure python:here.zmi_input_multiselect(here,name='search_meta_types',value=request.get('search_meta_types',[]),type='multiselect',lang_str='ATTR_TYPE',options=optpl)">the control</div>
	</div><!-- .form-group -->
</tal:comment>

<div id="search_results" class="form-group" style="display:none">
	<div class="col-md-10">
		<h4 tal:content="python:here.getZMILangStr('SEARCH_HEADERRESULT')">Result</h4>
		<div class="header row">
			<div class="col-md-6">
				<span class="small-head">
					<img src="/misc_/zms/loading.gif" alt="Loading..."/>
					<tal:block tal:content="python:here.getZMILangStr('MSG_LOADING')">loading</tal:block>
				</span>
			</div>
			<div class="meta-info col-sm-12 col-md-6 col-ns-5 col-ns-offset-1">
			</div>
		</div><!-- .header.row -->
		<div class="line row"></div><!-- .row -->
			<div class="pull-right">
				<ul class="pagination"></ul>
			</div>
	</div>
</div>

</form>
<tal:block tal:condition="python:request.has_key('raw') or request.get('search_meta_types')" tal:define="global
			qs python:here.getCatalogQueryString(request.get('raw',''),request.get('option',''));
			qres python:[]">

	<form class="form-horizontal" method="get">
		<h4 tal:content="python:here.getZMILangStr('SEARCH_HEADERRESULT')">Result</h4>
		<p tal:content="structure python:here.getZMILangStr('SEARCH_YOURQUERY')%('<b>%s</b>'%qs)+' '+here.getZMILangStr('SEARCH_RETURNEDRESULTS')+':'"></p>

	<!-- @TODO: ZMSIndex-based -->
	<tal:block tal:condition="python:not request.get('raw') and request.get('search_meta_types')">
		<tal:block tal:define="global dummy0 python:qres.extend(map(lambda x: {
				'ob':x,
				'title':x.getTitle(request),
				'raw':x.renderShort(request),
				'score':1,
				'time':x.attr('change_dt'),
				'url':'%s/manage_main'%x.absolute_url(),
				},here.getTreeNodes(request,request.get('search_meta_types'))))">
		</tal:block>
		<tal:block tal:define="global obs python:map(lambda x:x['ob'],qres)">
			<tal:block tal:content="structure python:here.zmi_manage_main_grid(obs=obs)">
				zmi_manage_main_grid
			</tal:block>
		</tal:block>
	</tal:block>

	</form>

</tal:block>

<div style="clear:both;">&nbsp;</div>
</div><!-- #zmi-tab -->
<tal:block tal:content="structure python:here.zmi_body_footer(here,request)">zmi_body_footer</tal:block>
<script type="text/javascript" charset="UTF-8" src="/++resource++zms_/ZMS/zmi_body_content_search.js"></script>
</body>
</html>