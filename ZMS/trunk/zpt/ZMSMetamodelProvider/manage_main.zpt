<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<tal:block tal:content="structure python:here.zmi_html_head(here,request)">zmi_html_head</tal:block>
<body tal:attributes="class python:' '.join(['zmi',request['lang'],'metas',here.meta_id])">
<tal:block tal:content="structure python:here.zmi_body_header(here,request,options=here.customize_manage_options())">zmi_body_header</tal:block>
<div id="zmi-tab">
<tal:block tal:content="structure python:here.zmi_breadcrumbs(here,request)">zmi_breadcrumbs</tal:block>

<script>

/**
 * Export xml.
 */
function zmiExportBtnClick(sender) {
	var fm = sender.form;
	var href = fm.action+'?lang='+getZMILang()+'&btn='+getZMILangStr('BTN_EXPORT');
	$('input[name="ids:list"]:checked',fm).each(function(){
			href += '&'+$(this).attr("name")+'='+$(this).val();
		});
	window.open(href);
	return false;
}

/**
 * Delete object.
 */
function zmiDeleteObjBtnClick(d) {
	if (confirm(getZMILangStr('MSG_CONFIRM_DELOBJ'))) {
		var $fm = $('form.form-horizontal:first');
		var html = '';
		for (var i in d) {
			$('input[name="' + i + '"]',$fm).remove();
			html += '<input type="hidden" name="' + i + '" value="' + d[i] +'">';
		}
		$fm
			.append(html)
			.submit();
	}
}

/**
 * Populate type.
 */
function zmiPopulateTypeSelect(sender) {
}

$(function() {
		$("select[name^=attr_type]").hover(zmiPopulateTypeSelect);
	});

</script>

<tal:block tal:define="global
		metaObjIds python:here.getMetaobjIds();
		metaObjs python:map(lambda x: here.getMetaobj(x), metaObjIds);
		metaObjPackages python:here.sort_list(here.distinct_list(map(lambda x: x.get('package'), metaObjs)))">

<form tal:condition="python:request.get('id')" class="form-horizontal" action="manage_changeProperties" method="post" enctype="multipart/form-data">
<tal:block tal:define="global metaObj python:here.getMetaobj(request['id'])">
	<input type="hidden" name="id" tal:attributes="value request/id">
	<input type="hidden" name="lang" tal:attributes="value request/lang">
	<legend>
		<tal:block tal:content="structure python:here.display_icon(request,metaObj['id'])">the icon</tal:block> 
		<tal:block tal:content="python:metaObj['name']">Name</tal:block>
	</legend>
	<div class="control-group">
		<label for="obj_name" class="control-label mandatory"><span tal:content="python:here.getZMILangStr('ATTR_DISPLAY')">Display</span></label>
		<div class="controls"><input type="text" id="obj_name" name="obj_name" tal:attributes="value python:metaObj['name']"></div><!-- .controls -->
	</div><!-- .control-group -->
	<div class="control-group">
		<label for="obj_revision" class="control-label mandatory"><span tal:content="python:here.getZMILangStr('ATTR_VERSION')">Version</span></label>
		<div class="controls"><input type="text" id="obj_revision" name="obj_revision" size="6" tal:attributes="value python:metaObj.get('revision','0.0.0')"></div><!-- .controls -->
	</div><!-- .control-group -->
	<div class="control-group">
		<label for="obj_type" class="control-label mandatory"><span tal:content="python:here.getZMILangStr('ATTR_TYPE')">Type</span></label>
		<div class="controls">
			<select id="obj_type" name="obj_type">
				<tal:block tal:repeat="objtype python:here.valid_objtypes">
					<option tal:attributes="value objtype; selected python:['','selected'][int(metaObj['type']==objtype)]" tal:content="python:here.getZMILangStr('SOTYPE_%s'%objtype.upper())">objtype</option>
				</tal:block>
			</select>
		</div><!-- .controls -->
	</div><!-- .control-group -->
	<div class="control-group">
		<label for="obj_package" class="control-label mandatory"><span tal:content="python:here.getZMILangStr('SOTYPE_ZMSPACKAGE')">Package</span></label>
		<div class="controls">
			<select id="obj_package" name="obj_package">
				<tal:block tal:repeat="metaObjPackage metaObjPackages">
					<option tal:attributes="value metaObjPackage; selected python:['','selected'][int(metaObj.get('package')==metaObjPackage)]" tal:content="metaObjPackage">metaObjPackage</option>
				</tal:block>
			</select>
		</div><!-- .controls -->
	</div><!-- .control-group -->

	<div class="control-group">
		<div class="controls">
			<button type="submit" name="btn" class="btn btn-primary" tal:attributes="value python:here.getZMILangStr('BTN_SAVE')" tal:content="python:here.getZMILangStr('BTN_SAVE')">Save</button>
			<button type="submit" name="btn" class="btn" tal:attributes="value python:here.getZMILangStr('BTN_BACK')" tal:content="python:here.getZMILangStr('BTN_BACK')">Back</button>
		</div><!-- .controls -->
	</div><!-- .control-group -->

	<table class="table table-striped table-bordered zmi-sortable">
		<colgroup>
			<col width="1em"/>
			<col width="1em"/>
			<col/>
			<col/>
			<col/>
			<col width="1em"/>
			<col width="1em"/>
			<col width="1em"/>
		</colgroup>
		<thead>
			<tr>
				<th></th>
				<th></th>
				<th tal:content="python:here.getZMILangStr('ATTR_ID')">Id</th>
				<th tal:content="python:here.getZMILangStr('ATTR_DISPLAY')">Display</th>
				<th tal:content="python:here.getZMILangStr('ATTR_TYPE')">Type</th>
				<th align="center" tal:attributes="title python:here.getZMILangStr('ATTR_MANDATORY')" class="control-label mandatory" style="width:2em!important">(<span></span>)</th>
				<th align="center" tal:attributes="title python:here.getZMILangStr('ATTR_MULTILANG')"><img src="/misc_/zms/btn_multilang1.gif"></th>
				<th align="center" tal:attributes="title python:here.getZMILangStr('ATTR_REPETITIVE')">0..n</th>
				<th></th>
				<th></th>
			<tr>
		</thead>
		<tbody tal:define="global objAttrIds python:here.getMetaobjAttrIds(metaObj['id'])">
			<tr tal:repeat="objAttrId objAttrIds">
				<tal:block tal:define="global objAttr python:here.getMetaobjAttr(metaObj['id'],objAttrId)">
					<td>
						<img class="grippy" src="/misc_/zms/spacer.gif">
						<input type="hidden" name="old_ids:list" tal:attributes="value objAttr/id">
						<select class="zmi-sort">
							<option tal:repeat="i python:range(0,len(objAttrIds))" tal:attributes="selected python:['','selected'][int(i==objAttrIds.index(objAttrId))]" tal:content="python:i+1">i+1</option>
						</select>
					</td>
					<td>
						<div class="btn-group">
							<a class="btn" tal:attributes="href python:'javascript:zmiDeleteObjBtnClick({btn:\'delete\',key:\'attr\',attr_id:\'%s\'})'%objAttrId; title python:here.getZMILangStr('BTN_DELETE')"><i class="icon-remove"></i></a>
						</div>
					</td>
					<td><input type="text" tal:attributes="name python:'attr_id_%s'%objAttrId; value python:objAttr['id']"></td>
					<td><input type="text" tal:attributes="name python:'attr_name_%s'%objAttrId; value python:objAttr['name']"></td>
					<tal:block tal:condition="python:objAttr['type'] in ['method','py','DTML Method','DTML Document']">
						<td colspan="5">
							<input type="hidden" tal:attributes="name python:'attr_type_%s'%objAttr['id']; value python:objAttr['type']">
							<div class="single-line"><textarea tal:attributes="name python:'attr_custom_%s'%objAttr['id']; title python:'%s (%s)'%(objAttr['id'],objAttr['type'])" tal:content="python:objAttr['custom']">custom</textarea></div>
						</td>
					</tal:block>
					<tal:block tal:condition="python:objAttr['type'] not in ['method','py','DTML Method','DTML Document']">
						<td>
							<select tal:attributes="name python:'attr_type_%s'%objAttrId">
								<option tal:attributes="value python:objAttr['type']" selected="selected">
									<tal:block tal:condition="python:objAttr['type'] in here.valid_datatypes" tal:content="python:objAttr['type']">type</tal:block>
									<tal:block tal:condition="python:objAttr['type'] == '*'" tal:content="python:'%s (*)'%here.getZMILangStr('ATTR_CUSTOM')">type</tal:block>
								</option>
							</select>
						</td>
						<td align="center"><input type="checkbox" tal:attributes="name python:'attr_mandatory_%s:int'%objAttr['id']; checked python:['','checked'][int(objAttr.get('mandatory',0)==1)]" value="1"></td>
						<td align="center"><input type="checkbox" tal:attributes="name python:'attr_multilang_%s:int'%objAttr['id']; checked python:['','checked'][int(objAttr.get('multilang',0)==1)]" value="1"></td>
						<td align="center"><input type="checkbox" tal:attributes="name python:'attr_repetitive_%s:int'%objAttr['id']; checked python:['','checked'][int(objAttr.get('repetitive',0)==1)]" value="1"></td>
						<td><div class="single-line" tal:condition="python:objAttr['type'] in ['autocomplete','multiautocomplete','multiselect','select','*']"><textarea tal:attributes="name python:'attr_keys_%s'%objAttr['id']; title python:here.getZMILangStr('ATTR_KEYS')" tal:content="python:'\n'.join(objAttr['keys'])">keys</textarea></div></td>
					</tal:block>
					<td></td>
				</tal:block>
			</tr>
			<tr>
				<td></td>
				<td><i class="icon-plus"></i></td>
				<td><input type="text" name="attr_id"></td>
				<td><input type="text" name="attr_name"></td>
				<td>
					<select name="attr_type">
						<option tal:content="python:'--- %s ---'%here.getZMILangStr('ATTR_PRIMITIVE')">type</option>
					</select>
				</td>
				<td align="center"><input type="checkbox" name="attr_mandatory" value="1"></td>
				<td align="center"><input type="checkbox" name="attr_multilang" value="1" checked="checked"></td>
				<td align="center"><input type="checkbox" name="attr_repetitive" value="1"></td>
				<td colspan="2">
					<button name="btn" type="submit" class="btn btn-primary" tal:attributes="value python:here.getZMILangStr('BTN_INSERT')" tal:content="python:here.getZMILangStr('BTN_INSERT')">Insert</button>
				</td>
			</tr>
		</tbody>
	</table>

	<div class="control-group">
		<div class="controls">
			<button type="submit" name="btn" class="btn btn-primary" tal:attributes="value python:here.getZMILangStr('BTN_SAVE')" tal:content="python:here.getZMILangStr('BTN_SAVE')">Save</button>
			<button type="submit" name="btn" class="btn" tal:attributes="value python:here.getZMILangStr('BTN_BACK')" tal:content="python:here.getZMILangStr('BTN_BACK')">Back</button>
		</div><!-- .controls -->
	</div><!-- .control-group -->

</tal:block>
</form>

<form tal:condition="python:not request.get('id')" class="form-horizontal" action="manage_changeProperties" method="post" enctype="multipart/form-data">
	<input type="hidden" name="lang" tal:attributes="value request/lang">
	<legend tal:content="python:here.getZMILangStr('TAB_METAOBJ')">Metaobj</legend>
	<p class="well well-small" tal:content="structure python:here.getZMILangStr('MSG_METAOBJ')">well</p>
	<table class="table table-striped table-bordered">
	<colgroup>
		<col width="20"/>
		<col width="50"/>
		<col width="50"/>
	</colgroup>
	<tbody>
	<tal:block tal:repeat="metaObjPackage metaObjPackages">
		<tr>
			<td>
				<input tal:condition="python:metaObjPackage" type="checkbox" name="ids:list" tal:attributes="value metaObjPackage">
			</td>
			<td>
				<div tal:condition="python:metaObjPackage" class="btn-group">
					<a class="btn" tal:attributes="href python:'?lang=%s&id=%s'%(request['lang'],metaObjPackage); title python:here.getZMILangStr('BTN_EDIT')+'...'"><i class="icon-edit"></i></a>
					<a class="btn" tal:attributes="href python:'javascript:zmiDeleteObjBtnClick({btn:getZMILangStr(\'BTN_DELETE\'),id:\'%s\',key:\'obj\'})'%metaObjPackage; title python:here.getZMILangStr('BTN_DELETE')+'...'"><i class="icon-remove"></i></a>
				</div>
			</td>
			<td colspan="2">
				<strong tal:content="python:['[default package]',metaObjPackage][int(len(metaObjPackage)>0)]">metaObjPackage</strong>
			</td>
		</tr>
		<tal:block tal:repeat="metaObj metaObjs">
			<tr tal:condition="python:metaObj['type']!='ZMSPackage' and metaObj.get('package')==metaObjPackage">
				<td>
					<input tal:condition="python:not metaObjPackage" type="checkbox" name="ids:list" tal:attributes="value python:metaObj['id']">
				</td>
				<td>
					<div class="btn-group">
						<a class="btn" tal:attributes="href python:'?lang=%s&id=%s'%(request['lang'],metaObj['id']); title python:here.getZMILangStr('BTN_EDIT')+'...'"><i class="icon-edit"></i></a>
						<a class="btn" tal:attributes="href python:'javascript:zmiDeleteObjBtnClick({btn:getZMILangStr(\'BTN_DELETE\'),id:\'%s\',key:\'obj\'})'%metaObj['id']; title python:here.getZMILangStr('BTN_DELETE')+'...'"><i class="icon-remove"></i></a>
					</div>
				</td>
				<td></td>
				<td>
					<span tal:attributes="title python:metaObj['id']">
						<tal:block tal:content="structure python:here.display_icon(request,metaObj['id'])">the icon</tal:block>
						<tal:block tal:content="python:'%s (%s)'%(metaObj['name'],here.getZMILangStr('SOTYPE_%s'%metaObj['type'].upper()))">metaObj</tal:block>
					</span>
				</td>
			</tr>
		</tal:block>
	</tal:block>
	</tbody>
	</table>
	<button name="btn" type="submit" class="btn" tal:attributes="value python:here.getZMILangStr('BTN_INSERT')" tal:content="python:here.getZMILangStr('BTN_INSERT')">Insert</button>
	&nbsp;&nbsp;
	<button name="btn" type="submit" class="btn" tal:attributes="value python:here.getZMILangStr('BTN_IMPORT')+'...'" tal:content="python:here.getZMILangStr('BTN_IMPORT')+'...'" onclick="$('#importLangDict').dialog({modal:true,title:$(this).text(),height:'auto',width:'auto'});return false;">Import...</button>
	<button name="btn" type="submit" class="btn" tal:attributes="value python:here.getZMILangStr('BTN_EXPORT')+'...'" tal:content="python:here.getZMILangStr('BTN_EXPORT')+'...'" onclick="zmiExportBtnClick(this); return false;">Export...</button>
</form>

</tal:block>

<div style="clear:both;">&nbsp;</div>
</div><!-- #zmi-tab -->
<tal:block tal:content="structure python:here.zmi_body_footer(here,request)">zmi_body_footer</tal:block>
</body>
</html>