<!DOCTYPE html>
<html lang="en">
<tal:block tal:content="structure python:here.zmi_html_head(here,request)">zmi_html_head</tal:block>
<body tal:attributes="class python:' '.join(['zmi',request['lang'],'metas',here.meta_id])">
<tal:block tal:content="structure python:here.zmi_body_header(here,request,options=here.customize_manage_options())">zmi_body_header</tal:block>
<div id="zmi-tab">
<tal:block tal:content="structure python:here.zmi_breadcrumbs(here,request)">zmi_breadcrumbs</tal:block>

<script>

/**
 * Export xml.
 */
function zmiExportBtnClick(sender) {
	var fm = $(sender).parents("form")[0];
	var href = fm.action+'?lang='+getZMILang()+'&btn='+getZMILangStr('BTN_EXPORT');
	$('input[name="ids:list"]:checked',fm).each(function(){
			href += '&'+$(this).attr("name")+'='+$(this).val();
		});
	window.open(href);
	return false;
}

/**
 * Delete object.
 */
function zmiDeleteObjBtnClick(sender,d) {
	if (confirm(getZMILangStr('MSG_CONFIRM_DELOBJ'))) {
		var $fm = $(sender).closest("form");
		var html = '';
		for (var i in d) {
			$('input[name="' + i + '"]',$fm).remove();
			html += '<input type="hidden" name="' + i + '" value="' + d[i] +'">';
		}
		$fm
			.append(html)
			.submit();
	}
}

$(function(){
	$('#editObj').dialog({modal:true,title:getZMILangStr('BTN_EDIT'),closeText:getZMILangStr('BTN_CLOSE'),height:'auto',width:'auto',minWidth:800})
});

</script>

<tal:block tal:define="global
		action python:'manage_changeMetacmds';
		metaCmdIds python:here.getMetaCmdIds()">

<div class="ui-helper-hidden" tal:condition="python:request.get('id','') in metaCmdIds">
	<div id="editObj" class="inner" tal:define="global metaCmd python:here.getMetaCmd(request['id'])">
		<form class="form-horizontal" tal:attributes="action action" method="post" enctype="multipart/form-data">
		<input type="hidden" name="id" tal:attributes="value request/id">
		<input type="hidden" name="lang" tal:attributes="value request/lang">
			<div class="control-group">
				<label for="el_id" class="control-label mandatory"><span tal:content="python:here.getZMILangStr('ATTR_ID')">Id</span></label>
				<div class="controls"><input type="text" name="el_id" tal:attributes="value python:metaCmd['id']"/></div><!-- .controls -->
			</div><!-- .control-group -->
			<div class="control-group">
				<label for="el_name" class="control-label mandatory"><span tal:content="python:here.getZMILangStr('ATTR_NAME')">Name</span></label>
				<div class="controls"><input type="text" name="el_name" tal:attributes="value python:metaCmd['name']"/></div><!-- .controls -->
			</div><!-- .control-group -->
			<div class="control-group">
				<label for="el_description" class="control-label"><span tal:content="python:here.getZMILangStr('ATTR_DC_DESCRIPTION')">Description</span></label>
				<div class="controls"><input type="text" name="el_description" tal:attributes="value python:metaCmd['description']"/></div><!-- .controls -->
			</div><!-- .control-group -->
			<div class="control-group">
				<label for="el_exec:int" class="control-label"><span>Exec.</span></label>
				<div class="controls"><input type="checkbox" name="el_exec:int" tal:attributes="checked python:['','checked'][int(metaCmd['exec'])]" value="1"/></div><!-- .controls -->
			</div><!-- .control-group -->
			<div class="control-group">
				<label for="el_icon_clazz" class="control-label"><span>Icon (Class)</span></label>
				<div class="controls"><input type="text" name="el_icon_clazz" tal:attributes="value python:metaCmd.get('icon_clazz','')"/></div><!-- .controls -->
			</div><!-- .control-group -->
			<tal:block tal:define="global ob python:getattr(here,request['id'],None)">
				<div class="control-group" style="height:20em;" tal:condition="python:ob is not None">
					<tal:block tal:condition="python:ob.meta_type in ['DTML Document','DTML Method']">
						<div class="ui-helper-hidden">
							<span id="action">manage_edit</span>
							<label for="title">Title</label><input id="title" name="title" class="form-element" tal:attributes="value ob/title">
						</div>
						<textarea id="text" name="el_data:text" class="ui-helper-hidden form-element" tal:content="ob/raw" style="width:100%">The object</textarea>
					</tal:block>
					<tal:block tal:condition="python:ob.meta_type=='Page Template'">
						<div class="ui-helper-hidden">
							<span id="action">pt_editAction</span>
							<label for="title">Title</label><input id="title" name="title" class="form-element" tal:attributes="value ob/title">
							<label for="content_type">Content-Type</label><input id="content_type" name="content_type" class="form-element" tal:attributes="value ob/content_type">
							<label for="expand">Expand</label><input id="expand" name="expand:int" class="form-element" tal:attributes="value ob/expand">
						</div>
						<textarea id="text" name="el_data:text" class="ui-helper-hidden form-element" tal:content="ob/read" style="width:100%">The object</textarea>
					</tal:block>
					<tal:block tal:condition="python:ob.meta_type=='Script (Python)'">
						<div class="ui-helper-hidden">
							<span id="action">ZPythonScriptHTML_editAction</span>
							<label for="title">Title</label><input id="title" name="title" class="form-element" tal:attributes="value ob/title">
							<label for="params">Parameter List</label><input id="params" name="params" class="form-element" tal:attributes="value ob/params">
							<label for="content_type">Content-Type</label><input id="content_type" name="content_type" class="form-element" value="python">
						</div>
						<textarea id="text" name="el_data:text" class="ui-helper-hidden form-element" tal:content="ob/read" style="width:100%">The object</textarea>
					</tal:block>

<!--
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
+++ Ajax.org Cloud9 Editor
+++ http://ace.ajax.org
+++ @see $ZMS_HOME/plugins/www/ace.ajax.org
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
-->
<div id="editor" class="zmiNeutralColorWhite" style="height: 92%; width: 100%;">some text</div>
<script type="text/javascript" charset="UTF-8" src="/++resource++zms_/ace.ajax.org/ace.js"></script>
<script type="text/javascript" charset="UTF-8" src="/++resource++zms_/ace.ajax.org/theme-eclipse.js"></script>
<script type="text/javascript" charset="UTF-8" src="/++resource++zms_/ace.ajax.org/mode-html.js"></script>
<script type="text/javascript" charset="UTF-8" src="/++resource++zms_/ace.ajax.org/mode-css.js"></script>
<script type="text/javascript" charset="UTF-8" src="/++resource++zms_/ace.ajax.org/mode-javascript.js"></script>
<script type="text/javascript" charset="UTF-8" src="/++resource++zms_/ace.ajax.org/mode-python.js"></script>
<script type="text/javascript" charset="UTF-8" src="/++resource++zms_/ace.ajax.org/mode-xml.js"></script>
<script type="text/javascript">
$(function() {
	if ($("textarea#text").length == 0) {
		$("#editor").hide();
	}
	else {
		// @see https://github.com/ajaxorg/ace/wiki/Embedding---API
		editor = ace.edit("editor");
		var content_type = null;
		if ($("input#content_type")) {
			content_type = $("input#content_type").val();
		}
		if (content_type == null) {
			var absolute_url = $("span#absolute_url").text();
			var id = absolute_url.substr(absolute_url.lastIndexOf("/")+1);
			if (id.endsWith(".css")) {
				content_type = "text/css";
			}
			else if (id.endsWith(".js")) {
				content_type = "text/javascript";
			}
			else {
				content_type = "text/html";
			}
		}
		var Mode = null;
		if (content_type == "text/html") {
			Mode = require("ace/mode/html").Mode;
		}
		else if (content_type == "text/css" || content_type == "application/x-css") {
			Mode = require("ace/mode/css").Mode;
		}
		else if (content_type == "text/javascript" || content_type == "application/x-javascript") {
			Mode = require("ace/mode/javascript").Mode;
		}
		else if (content_type == "text/xml") {
			Mode = require("ace/mode/xml").Mode;
		}
		else if (content_type == "python") {
			Mode = require("ace/mode/python").Mode;
		}
		if (Mode != null) {
			editor.getSession().setMode(new Mode());
		}
		editor.setTheme("ace/theme/eclipse");
		editor.getSession().setValue($("textarea#text").val());
		editor.getSession().on("change",function() {
				$("textarea#text").val(editor.getSession().getValue());
			});
	}
});
</script>

				</div><!-- .control-group -->
			</tal:block>
			<div class="control-group">
				<table>
				<thead>
				<tr>
					<th tal:content="python:here.getZMILangStr('TAB_ACCESS')">Access</th>
					<th tal:content="python:here.getZMILangStr('ATTR_NODE')">Node</th>
					<th tal:content="python:here.getZMILangStr('ATTR_ROLES')">Roles</th>
					<th tal:content="python:here.getZMILangStr('ATTR_OBJECTS')">Objects</th>
				</tr>
				</thead>
				<tbody>
				<tr valign="top">
					<td tal:content="python:here.getZMILangStr('BTN_EXECUTE')">Execute</td>
					<td>
						<div class="single-line input-append zmi-nodes">
							<textarea tal:attributes="title python:here.getZMILangStr('ATTR_NODE')" name="el_nodes" tal:content="python:metaCmd.get('nodes','{$}')"></textarea>
						</div>
					</td>
					<td>
						<select name="el_roles:list" multiple="multiple" tal:attributes="size python:min(10,len(here.userdefined_roles()))">
							<tal:block tal:repeat="role python:here.userdefined_roles()">
								<tal:block tal:define="global role_str python:'ROLE_%s'%role.upper(); role_lang_str python:here.getZMILangStr(role_str)">
									<option tal:attributes="value role; selected python:['','selected'][int(role in metaCmd.get('roles',[]))]" tal:content="python:[role,role_lang_str][int(role_str!=role_lang_str)]">role</option>
								</tal:block>
							</tal:block>
						</select>
					</td>
					<td>
						<select name="el_meta_types:list" multiple="multiple" tal:attributes="size python:min(10,len(here.getMetaobjIds()+here.metaobj_manager.valid_objtypes))">
							<tal:block tal:repeat="meta_type python:here.getMetaobjIds()">
								<option tal:attributes="value meta_type; selected python:['','selected'][int(meta_type in metaCmd.get('meta_types',[]))]" tal:content="python:here.display_type(request,meta_type)">meta_type</option>
							</tal:block>
							<tal:block tal:repeat="objtype python:here.metaobj_manager.valid_objtypes">
								<tal:block tal:define="global meta_type python:'type(%s)'%objtype">
									<option tal:attributes="value meta_type; selected python:['','selected'][int(meta_type in metaCmd.get('meta_types',[]))]" tal:content="meta_type">meta_type</option>
								</tal:block>
							</tal:block>
						</select>
					</td>
				</tr>
				</tbody>
				</table>
			</div><!-- .control-group -->
			<div class="control-group">
				<div class="controls save">
					<button type="submit" name="btn" class="btn btn-primary" tal:attributes="value python:here.getZMILangStr('BTN_SAVE')" tal:content="python:here.getZMILangStr('BTN_SAVE')">Save</button>
					<button type="submit" name="btn" class="btn" tal:attributes="value python:here.getZMILangStr('BTN_CLOSE')" tal:content="python:here.getZMILangStr('BTN_CLOSE')">Close</button>
				</div><!-- .controls -->
			</div><!-- .control-group -->
		</form>
	</div><!-- .inner -->
</div><!-- #editObj -->

<div class="ui-helper-hidden">
	<div id="insertObj" class="inner">
		<form class="form-horizontal" tal:attributes="action action" method="post" enctype="multipart/form-data">
			<input type="hidden" name="lang" tal:attributes="value request/lang">
			<div class="control-group">
				<label class="control-label mandatory" for="_id"><span tal:content="python:here.getZMILangStr('ATTR_ID')">Id</span></label>
				<div class="controls">
					<input type="text" name="_id">
				</div><!-- .controls -->
			</div><!-- .control-group -->
			<div class="control-group">
				<label class="control-label mandatory" for="_name"><span tal:content="python:here.getZMILangStr('ATTR_DISPLAY')">Display</span></label>
				<div class="controls">
					<input type="text" name="_name">
				</div><!-- .controls -->
			</div><!-- .control-group -->
			<div class="control-group">
				<label class="control-label mandatory" for="_type"><span tal:content="python:here.getZMILangStr('ATTR_TYPE')">Type</span></label>
						<div class="controls">
					<select name="_type">
						<option value="Script (Python)">Script (Python)</option>
						<option value="Page Template">Page Template</option>
					</select>
				</div><!-- .controls -->
			</div><!-- .control-group -->
			<div class="control-group">
				<label class="control-label" for="_exec"><span>Exec.</span></label>
				<div class="controls">
					<input type="checkbox" name="_exec:int" value="1" checked="checked">
				</div><!-- .controls -->
			</div><!-- .control-group -->
			<div class="control-group">
				<div class="controls">
					<button name="btn" type="submit" class="btn btn-primary" tal:attributes="value python:here.getZMILangStr('BTN_INSERT')" tal:content="python:here.getZMILangStr('BTN_INSERT')">Insert</button>
				</div>
			</div><!-- .control-group -->
		</form>
	</div><!-- .inner -->
</div><!-- #insertObj -->

<div class="ui-helper-hidden">
	<div id="importConf" class="inner">
		<form class="form-horizontal" tal:attributes="action action" method="post" enctype="multipart/form-data">
			<input type="hidden" name="lang" tal:attributes="value request/lang">
			<div class="control-group">
				<label class="control-label" for="file"><i class="icon-folder-open"></i> <tal:block tal:content="python:here.getZMILangStr('ATTR_FILE')">File</tal:block></label>
				<div class="controls">
					<input name="file" type="file">
				</div><!-- .controls -->
			</div><!-- .control-group -->
			<div class="control-group">
				<label class="control-label" for="file" tal:content="python:here.getZMILangStr('OR')">or</label>
				<div class="controls">
					<select id="init" name="init" onfocus="zmiExpandConfFiles(this,'.metacmd.')" onmouseover="zmiExpandConfFiles(this,'.metacmd.')">
						<option value="">--- <tal:block tal:content="python:here.getZMILangStr('BTN_INIT')">Init</tal:block>... ---</option>
					</select>
				</div><!-- .controls -->
			</div><!-- .control-group -->
			<div class="control-group">
				<div class="controls">
						<button name="btn" type="submit" class="btn btn-primary" tal:attributes="value python:here.getZMILangStr('BTN_IMPORT')" tal:content="python:here.getZMILangStr('BTN_IMPORT')">Import</button>
				</div>
			</div>
		</form>
	</div><!-- .inner -->
</div><!-- #importConf -->

<form class="form-horizontal" tal:attributes="action action" method="post" enctype="multipart/form-data">
	<input type="hidden" name="lang" tal:attributes="value request/lang">
	<legend tal:content="python:here.getZMILangStr('TAB_METACMD')">Metacmd</legend>
	<p class="well well-small" tal:content="structure python:here.getZMILangStr('MSG_METACMD')">well</p>
	<table class="table table-striped table-bordered table-hover">
	<colgroup>
		<col width="40"/>
	</colgroup>
	<thead>
		<tr>
			<th>
				<div class="btn-group">
					<span class="btn" tal:attributes="title python:'%s/%s'%(here.getZMILangStr('BTN_SLCTALL'),here.getZMILangStr('BTN_SLCTNONE'))" onclick="zmiToggleSelectionButtonClick(this)"><i class="icon-check"></i></span>
				</div>
			</th>
			<th colspan="3">
				<div class="btn-group">
					<span class="btn btn-primary" tal:attributes="title python:here.getZMILangStr('BTN_INSERT')+'...'" onclick="$('#insertObj').dialog({modal:true,title:$(this).attr('title'),height:'auto',width:'auto'})"><i class="icon-plus"></i></span>
					<span class="btn" tal:attributes="title python:here.getZMILangStr('BTN_DELETE')+'...'" onclick="zmiDeleteObjBtnClick(this,{btn:getZMILangStr('BTN_DELETE'),key:'obj'})"><i class="icon-remove"></i></span>
					<span class="btn" tal:attributes="title python:here.getZMILangStr('BTN_IMPORT')+'...'" onclick="$('#importConf').dialog({modal:true,title:$(this).attr('title'),height:'auto',width:'auto'})"><i class="icon-upload-alt"></i></span>
					<span class="btn" tal:attributes="title python:here.getZMILangStr('BTN_EXPORT')+'...'" onclick="zmiExportBtnClick(this)"><i class="icon-download-alt"></i></span>
				</div>
			</th>
		</tr>
		<tr>
			<th></th>
			<th tal:content="python:here.getZMILangStr('ATTR_ID')">Id</th>
			<th tal:content="python:here.getZMILangStr('ATTR_SIZE')">Size</th>
			<th tal:content="python:here.getZMILangStr('ATTR_LAST_MODIFIED')">Last Modified</th>
		</tr>
	</thead>
	<tbody>
	<tal:block tal:repeat="metaCmdId metaCmdIds">
		<tr tal:define="global metaCmd python:here.getMetaCmd(metaCmdId); ob python:getattr(here,metaCmdId)">
			<td>
				<input type="checkbox" name="ids:list" tal:attributes="value metaCmd/id">
			</td>
			<td>
				<a tal:attributes="href python:'?lang=%s&id=%s'%(request['lang'],metaCmd['id'])">
					<img tal:attributes="src python:ob.icon; title python:ob.meta_type"/>
					<tal:block tal:content="python:metaCmd['id']">Id</tal:block>
				</a>
				(<tal:block tal:content="python:metaCmd['name']">Name</tal:block>)
			</td>
			<td>
				<tal:block tal:content="python:here.getDataSizeStr(ob.get_size())">Size</tal:block>
			</td>
			<td>
				<tal:block tal:content="python:here.getLangFmtDate(ob.bobobase_modification_time().timeTime())">Modification-Time</tal:block>
			</td>
		</tr>
	</tal:block>
	</tbody>
	</table>
</form>

</tal:block>

<div style="clear:both;">&nbsp;</div>
</div><!-- #zmi-tab -->
<tal:block tal:content="structure python:here.zmi_body_footer(here,request)">zmi_body_footer</tal:block>
</body>
</html>