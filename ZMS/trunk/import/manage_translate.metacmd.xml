<?xml version="1.0" encoding="utf-8"?>

<dictionary>
  <item key="custom"><![CDATA[<dtml-return "len(getLangIds())>1">]]></item>
  <item key="data"><![CDATA[<dtml-comment>
################################################################################
2011-09-19 [zmsdev] applied fix 
2011-09-16 [zmsdev] applied fix 
2011-07-06 [fhoffmann] SESSION based lang settings
2011-06-09 [fhoffmann] Save Automatic Pre-Translation
2011-06-07 [fhoffmann] Google Translator Element added
2011-04-11 [zmsdev] Replaced fancybox by jquery ui dialog.
2011-28-01 [fhoffmann] Revised for fancybox transparency css
2011-21-01 [fhoffmann] Revised for maximize css
2011-01-17 [zmsdev] Revised table-structure: one row per object
2010-12-02 [zmsdev] Initial revision
################################################################################
</dtml-comment>

<dtml-var manage_page_header>

<style type="text/css">
.zmi-translate-left {
	padding:4px;
	background-color:#FFFFE8;
}
.zmi-translate-left .zmi-translate-element {
	margin:5px 10px 5px 0px;
	border: 1px solid darkgreen;
}
.zmi-translate-left .zmi-translate-element-id {
	color:white;
	background-color: darkgreen;
}
.zmi-translate-right {
	padding:4px;
	background-color:#FFFFFF;
}
.zmi-translate-right .zmi-translate-element {
	margin:5px 10px 5px 0px;
	border: 1px solid red;
}
.zmi-translate-right .zmi-translate-element-id {
	color:white;
	background-color: red;
}
.zmiRenderShort {
	width:350px!important;
}
.zmiRenderShort {
	width:350px!important;
}
body.maximized .zmiRenderShort {
	width:auto !important;
}
.ui-widget-overlay {
  opacity: 0.2;
}
</style>

<script>
function save(sender) {
	var $container_div = $($(sender).parents("div")[0]);
	var $rendershort_div = $("div.zmiRenderShort div.contentEditable",$container_div);
	var id = $rendershort_div.attr("id");
	id = id.substr(id.indexOf("_")+1);
	id = id.substr(0,id.lastIndexOf("_"));
	var lang = $rendershort_div.attr("id");
	lang = lang.substr(lang.lastIndexOf("_")+1);
	var html = $rendershort_div.html();
	var text = html;
	text = text.replace(/<font(.*?)>/gi,'');
	text = text.replace(/<\/font(.*?)>/gi,'');
	// Handle start-tag.
	var startTag = text.split(">")[0].toLowerCase();
	startTag = startTag.substr(startTag.indexOf("<")+1);
	if (startTag.indexOf(" ")>0) {
		startTag = startTag.substr(0,startTag.indexOf(" "));
	}
	var sre = '<'+startTag+'(.*?)>((.|\n|\r|\t)*?)<\/'+startTag+'(.*?)>';
	var re = new RegExp(sre,'gi');
	text = text.replace(re,'$2');
	text = text.replace(/<span class=\"unicode\">(.*?)<\/span>/g,'');
	// Handle sub-tag.
	var subTag = text.split(">")[0].toLowerCase();
	subTag = subTag.substr(subTag.indexOf("<")+1);
	if (subTag.indexOf(" ")>0) {
		startTag = subTag.substr(0,subTag.indexOf(" "));
	}
	if (subTag == 'br') {
		re = new RegExp('<'+subTag+'>','gi');
		text = text.replace(re,'\n');
	}
	else {
		re = new RegExp('<'+subTag+'(.*?)>','gi');
		text = text.replace(re,'');
		re = new RegExp('<\/'+subTag+'>','gi');
		text = text.replace(re,'\n');
	}
	if (confirm("Save Automatic Pre-Translation?\n\n"+text)) {
		$container_div.addClass('zmiTeaserColor');
		var params = {};
		params['lang'] = lang;
		params['text_'+lang] = text;
		$.post(id+'/manage_changeProperties',params,function(data){
			$container_div.removeClass('zmiTeaserColor');
		},'html');
	}
}
</script>

</head>
<dtml-var manage_tabs>
<dtml-unless fmName><dtml-call "REQUEST.set('fmName', 'form0')"></dtml-unless>

<dtml-call "REQUEST.set('lang1_options',getLangTree(getDCCoverage(REQUEST)[len('global.'):]))">
<dtml-if "SESSION.get('lang1','')==''"
	><dtml-call "SESSION.set('lang1',REQUEST.get('lang1',lang1_options[0][0]))"
	><dtml-call "REQUEST.set('lang1',SESSION.get('lang1'))"  
><dtml-elif "REQUEST.get('lang1','')==''"
	><dtml-call "REQUEST.set('lang1',SESSION.get('lang1',lang1_options[0][0]))"
><dtml-else
	><dtml-call "SESSION.set('lang1',REQUEST.get('lang1'))"
></dtml-if>
<dtml-call "REQUEST.set('lang1_bk',lang1)"> 

<dtml-call "REQUEST.set('lang2_options',getLangTree(getDCCoverage(REQUEST)[len('global.'):])[1:])">
<dtml-if "SESSION.get('lang2','')==''"
	><dtml-call "SESSION.set('lang2',REQUEST.get('lang2',lang2_options[0][0]))"
	><dtml-call "REQUEST.set('lang2',SESSION.get('lang2'))"  
><dtml-elif "REQUEST.get('lang2','')==''"
	><dtml-call "REQUEST.set('lang2',SESSION.get('lang2',lang2_options[0][0]))"
><dtml-else
	><dtml-call "SESSION.set('lang2',REQUEST.get('lang2'))"
></dtml-if>
<dtml-call "REQUEST.set('lang2_bk',lang2)">

<form id="<dtml-var fmName>" method="get">
<table cellspacing="0" cellpadding="0" border="0" width="100%">
<tr valign="top">
<dtml-let childNodes="filter(lambda x: x.isPageElement(),getObjChildren('e',REQUEST))" exclude_langs="[]">
<dtml-in "['left','right']">
<dtml-let si=sequence-item lang_req_key="{'left':'lang1','right':'lang2'}[si]">
<td class="zmi-translate-<dtml-var si> <dtml-var "['translate','notranslate'][si=='left']">" width="50%">
    <select class="form-small notranslate" name="<dtml-var lang_req_key>" onchange="document.getElementById('<dtml-var fmName>').submit();">
     <dtml-in "REQUEST.get('%s_options'%lang_req_key)" mapping>
      <option value="<dtml-var sequence-key>" <dtml-if "_['sequence-key']==REQUEST[lang_req_key]">selected="selected"</dtml-if>><dtml-var label></option>
     </dtml-in>
    </select>
    <dtml-call "REQUEST.set(lang_req_key+'_bk',REQUEST.get(lang_req_key))">
    <dtml-call "REQUEST.set('lang',REQUEST.get(lang_req_key))">
   <div id="<dtml-var id>" class="zmi-translate-element">
    <span class="zmi-translate-element-id notranslate"><dtml-var id></span>
    <div class="zmiRenderShort" id="contentEditable_<dtml-var id>_<dtml-var lang>">
     <dtml-if "meta_id not in ['ZMSDocument','ZMSFolder','ZMS']">
      <dtml-var "getBodyContent(REQUEST)">
     <dtml-else>
      <h1><dtml-var "getTitle(REQUEST)"></h1>
      <p class="description"><dtml-var "getDCDescription(REQUEST)" newline_to_br></p>
     </dtml-if>
    </div>
   </div>
</td>
</dtml-let>
</dtml-in>
<dtml-in childNodes>
 <tr valign="top">
  <dtml-in "['left','right']">
   <dtml-let si=sequence-item lang_req_key="{'left':'lang1','right':'lang2'}[si]">
    <td class="zmi-translate-<dtml-var si> <dtml-var "['translate','notranslate'][si=='left']">">
    <dtml-call "REQUEST.set('lang',REQUEST.get(lang_req_key+'_bk'))">
    <div id="<dtml-var id>" class="zmi-translate-element">
     <span class="zmi-translate-element-id notranslate" <dtml-if "isActive(REQUEST)!=True"
      >title="Inactive" style="background-color:#999"</dtml-if>><dtml-var id><dtml-if "si!='left'"><span title="<dtml-var lang>: Save Automatic Pre-Translation" style="cursor:pointer;" onclick="save(this)"> â–¼ </span></dtml-if></span>
      <dtml-var "renderShort(REQUEST)">
    </div>
    </td>
   </dtml-let>
  </dtml-in>
 </tr>
</dtml-in>
</dtml-let>
</tr>
</table>
</form>
<!-- Google Translate Element -->
<div id="google_translate_element" style="display:block"></div><script>
function googleTranslateElementInit() {
  new google.translate.TranslateElement({pageLanguage: "de"}, "google_translate_element");
};</script>
<script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
<!-- /Google Translate Element -->
<dtml-comment>
<pre title="DEBUG CODE">
REQUEST lang1: <dtml-var "REQUEST.get('lang1','')">
REQUEST lang2: <dtml-var "REQUEST.get('lang2','')">
SESSION lang1: <dtml-var "SESSION.get('lang1','')">
SESSION lang2: <dtml-var "SESSION.get('lang2','')">
</pre>
</dtml-comment>
<dtml-var manage_page_footer>]]>
  </item>
  <item key="description"></item>
  <item key="exec" type="int">0</item>
  <item key="id"><![CDATA[manage_translate]]></item>
  <item key="meta_type"><![CDATA[DTML Method]]></item>
  <item key="meta_types" type="list">
    <list>
      <item><![CDATA[ZMSDocument]]></item>
      <item><![CDATA[ZMSFolder]]></item>
      <item><![CDATA[ZMS]]></item>
    </list>
  </item>
  <item key="name"><![CDATA[Translate...]]></item>
  <item key="roles" type="list">
    <list>
      <item><![CDATA[ZMSEditor]]></item>
      <item><![CDATA[ZMSAuthor]]></item>
      <item><![CDATA[ZMSAdministrator]]></item>
    </list>
  </item>
</dictionary>